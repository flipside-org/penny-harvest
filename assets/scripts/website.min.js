function createCookie(a,b,c){var d="";if(c){var e=new Date;e.setTime(e.getTime()+24*c*60*60*1e3),d="; expires="+e.toGMTString()}document.cookie=a+"="+b+d+"; path=/"}function readCookie(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(b))return e.substring(b.length,e.length)}return null}function eraseCookie(a){createCookie(a,"",-1)}var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(a){var b,c,d,e,f,g,h,i="",j=0;for(a=Base64._utf8_encode(a);j<a.length;)b=a.charCodeAt(j++),c=a.charCodeAt(j++),d=a.charCodeAt(j++),e=b>>2,f=(3&b)<<4|c>>4,g=(15&c)<<2|d>>6,h=63&d,isNaN(c)?g=h=64:isNaN(d)&&(h=64),i=i+this._keyStr.charAt(e)+this._keyStr.charAt(f)+this._keyStr.charAt(g)+this._keyStr.charAt(h);return i},decode:function(a){var b,c,d,e,f,g,h,i="",j=0;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");j<a.length;)e=this._keyStr.indexOf(a.charAt(j++)),f=this._keyStr.indexOf(a.charAt(j++)),g=this._keyStr.indexOf(a.charAt(j++)),h=this._keyStr.indexOf(a.charAt(j++)),b=e<<2|f>>4,c=(15&f)<<4|g>>2,d=(3&g)<<6|h,i+=String.fromCharCode(b),64!=g&&(i+=String.fromCharCode(c)),64!=h&&(i+=String.fromCharCode(d));return i=Base64._utf8_decode(i)},_utf8_encode:function(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);128>d?b+=String.fromCharCode(d):d>127&&2048>d?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(63&d|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(63&d|128))}return b},_utf8_decode:function(a){for(var b="",c=0,d=0,e=0;c<a.length;)d=a.charCodeAt(c),128>d?(b+=String.fromCharCode(d),c++):d>191&&224>d?(e=a.charCodeAt(c+1),b+=String.fromCharCode((31&d)<<6|63&e),c+=2):(e=a.charCodeAt(c+1),c3=a.charCodeAt(c+2),b+=String.fromCharCode((15&d)<<12|(63&e)<<6|63&c3),c+=3);return b}};Base64.encodeObj=function(a){return Base64.encode(JSON.stringify(a))},Base64.decodeObj=function(a){try{return JSON.parse(Base64.decode(a))}catch(b){return null}},function(a){a.fn.activate=function(){return this.addClass("on")},a.fn.activateToggle=function(){return this.toggleClass("on")},a.fn.deactivate=function(){return this.removeClass("on")},a.fn.isActive=function(){return this.hasClass("on")},a.fn.getFilterId=function(){return this.attr("data-filter-id")},a.fn.getByFilterId=function(a){return this.filter('[data-filter-id="'+a+'"]')},a.fn.getActive=function(){return this.filter(".on")}}(jQuery);var PH_filters={settings:{cb_click_impact_area:function(){},cb_click_keyword:function(){},cb_initialize:function(){}},impact_areas:[],keywords:[],init:function(a){PH_filters.settings=$.extend({},PH_filters.settings,a),PH_filters.impact_areas=$('[data-filter-type="impact_area"]'),PH_filters.keywords=$('[data-filter-type="keyword"]'),PH_filters.impact_areas.click(function(a){a.preventDefault(),$(this).activateToggle(),PH_filters.keywords.deactivate(),PH_filters.settings.cb_click_impact_area.apply(this),PH_filters.save_to_url()}),PH_filters.keywords.click(function(a){a.preventDefault(),$(this).activateToggle(),PH_filters.impact_areas.deactivate(),PH_filters.settings.cb_click_keyword.apply(this),PH_filters.save_to_url()}),PH_filters.load_from_url(),PH_filters.settings.cb_initialize()},get_active:function(a){var b=[];switch(a){case"impact_areas":PH_filters.impact_areas.getActive().each(function(){b.push($(this).getFilterId())});break;case"keywords":PH_filters.keywords.getActive().each(function(){b.push($(this).getFilterId())})}return b},save_to_url:function(){var a={i:PH_filters.get_active("impact_areas"),k:PH_filters.get_active("keywords")};if(0===a.i.length&&0===a.k.length)location.hash="!";else{var b=Base64.encodeObj(a);location.hash=b}},load_from_url:function(){if(!location.hash||"#!"==location.hash)return!1;var a=location.hash.substring(1),b=Base64.decodeObj(a);return null===b?!1:($.each(b.i,function(a,b){PH_filters.impact_areas.getByFilterId(b).activate()}),void $.each(b.k,function(a,b){PH_filters.keywords.getByFilterId(b).activate()}))}};$(document).ready(function(){$('a[data-dropdown="action-bttn"]').click(function(a){a.stopPropagation(),a.preventDefault();var b=$(this),c=b.siblings(".action-dropdown");$(".action-dropdown").not(c).removeClass("revealed"),$('a[data-dropdown="action-bttn"]').not(b).removeClass("current"),b.toggleClass("current"),c.toggleClass("revealed")}),$(document).click(function(){$(".action-dropdown").removeClass("revealed"),$('a[data-dropdown="action-bttn"]').removeClass("current")})}),$(function(){var a=$(".filters");if(a.length){a=$.extend(a,{open:function(){$(this).animate({bottom:0},250)},close:function(){var a=$(this),b=a.height()-8;a.animate({bottom:-b},250)}});var b=$(".filters-toggle");b.click(function(b){b.preventDefault();var c=$(this);c.isActive()?(createCookie("filter_panel","close",10),c.deactivate(),a.close()):(createCookie("filter_panel","open",10),c.activate(),a.open())});var c=readCookie("filter_panel");null!==c&&("open"==c?(a.open(),b.activate()):(a.close(),b.deactivate()))}$("#national-orgs").length&&$.get("/json/national-orgs.json",function(a){var b=function(){this.page_size=20,this.current_page=0,this.render_batch=null;var a=$("#national-hub-template").html();this.template=Handlebars.compile(a),this.content_holder=$("#national-orgs .national"),this.load_more_button=$("#show-more-trigger"),this.render=function(a){null===a?a=render_batch:(this.reset(),render_batch=a);var b=this.page_size*this.current_page,c=b+this.page_size,d=a.slice(b,c),e=this.template({orgs:d});this.content_holder.append(e),b=this.page_size*(this.current_page+1),c=b+this.page_size,d=a.slice(b,c),0===d.length&&this.load_more_button.addClass("disabled")},this.reset=function(){this.current_page=0,this.load_more_button.removeClass("disabled"),this.content_holder.html("")},this.render_next=function(){this.current_page++,this.render(null)}},c=new b;$("#show-more-trigger").click(function(a){a.preventDefault();var b=$(this);b.hasClass("disabled")||c.render_next()}),PH_filters.init({cb_click_impact_area:function(){var b=PH_filters.get_active("impact_areas");if(b.length){var d=$.grep(a,function(a){return $.inArray(a.impact_area.id,b)>=0});c.render(d)}else c.render(a)},cb_click_keyword:function(){var b=PH_filters.get_active("keywords");if(b.length){var d=$.grep(a,function(a){for(var c in b){var d=!1;for(var e in a.keywords)if(b[c]==a.keywords[e].id){d=!0;break}if(!d)return!1}return!0});c.render(d)}else c.render(a)},cb_initialize:function(){var b,d=PH_filters.get_active("keywords"),e=PH_filters.get_active("impact_areas");d.length||e.length?e.length?(b=$.grep(a,function(a){return $.inArray(a.impact_area.id,e)>=0}),c.render(b)):d.length&&(b=$.grep(a,function(a){for(var b in d){var c=!1;for(var e in a.keywords)if(d[b]==a.keywords[e].id){c=!0;break}if(!c)return!1}return!0}),c.render(b)):c.render(a)}})},"json"),$("#map").length&&$.get("/json/local-orgs.geojson",function(a){function b(a){g.eachLayer(function(b){a(b.feature)?f.hasLayer(b)||f.addLayer(b):f.hasLayer(b)&&f.removeLayer(b)})}var c=function(a){this.key=a,this.url="http://www.mapquestapi.com/geocoding/v1/address",this.query=function(a,b){$.get(this.url,{key:this.key,location:a},function(a){a.results[0].locations.length>0?b(!0,a.results[0].locations[0]):b(!1,[])})}},d=new c("Fmjtd|luur290y2h%2Cr5%3Do5-90zl54"),e=L.mapbox.map("map","flipside.hgeapagi",{zoomControl:!1,minZoom:3,maxZoom:18,maxBounds:L.latLngBounds([-90,-180],[90,180])}).setView([40.75,-73.9],11),f=new L.MarkerClusterGroup({showCoverageOnHover:!1,iconCreateFunction:function(a){return new L.DivIcon({className:"marker cluster",iconSize:[],html:a.getChildCount()})}}),g=L.geoJson(a,{onEachFeature:function(a,b){var c=a.properties,d="marker impact-area "+c.impact_area.class,e=L.divIcon({className:d,iconSize:[],popupAnchor:[0,-30]});b.setIcon(e);var f='<article><header><h1 class="prime-title"><a href="'+c.url+'">'+c.title+'</a></h1></header><div class="content">'+c.content+'</div><footer><a href="'+c.url+'" class="go-link">Learn more about us</a></footer></article>';b.bindPopup(f)}});f.addLayer(g),e.addLayer(f),$(".geocoder form").submit(function(a){a.preventDefault();var b=$(".map-geocoder-input",this).val();d.query(b,function(a,b){if(a){var c=b.latLng.lat,d=b.latLng.lng,f=1;switch(b.geocodeQuality){case"COUNTRY":f=7;break;case"CITY":f=14;break;case"ADDRESS":f=17;break;case"STREET":f=17}e.setView([c,d],f,{animate:!0})}})}),navigator.geolocation?($(".map-geocoder-locate").click(function(a){a.preventDefault(),$(this).addClass("locating"),e.locate()}),e.on("locationfound",function(a){$(".map-geocoder-locate").removeClass("locating"),e.fitBounds(a.bounds)}),e.on("locationerror",function(){$(".map-geocoder-locate").removeClass("locating")})):$(".map-geocoder-locate").remove(),PH_filters.init({cb_click_impact_area:function(){var a=PH_filters.get_active("impact_areas");b(function(b){return a.length?$.inArray(b.properties.impact_area.id,a)>=0:!0})},cb_click_keyword:function(){var a=PH_filters.get_active("keywords");b(function(b){if(a.length)for(var c in a){var d=!1;for(var e in b.properties.keywords)if(a[c]==b.properties.keywords[e].id){d=!0;break}if(!d)return!1}return!0})},cb_initialize:function(){var a=PH_filters.get_active("keywords"),c=PH_filters.get_active("impact_areas");a.length||c.length?c.length?b(function(a){return $.inArray(a.properties.impact_area.id,c)>=0}):a.length&&b(function(b){for(var c in a){var d=!1;for(var e in b.properties.keywords)if(a[c]==b.properties.keywords[e].id){d=!0;break}if(!d)return!1}return!0}):b(function(){return!0})}})},"json")}),$(document).ready(function(){$(".menu-title .toggle").click(function(a){a.stopPropagation(),a.preventDefault(),$(".menu-wrapper").toggleClass("visible"),$(".action-dropdown").removeClass("revealed"),$('a[data-dropdown="action-bttn"]').removeClass("current")}),$(document).click(function(){$(".menu-wrapper").removeClass("visible")})}),$(function(){$("[data-modal-id]").click(function(a){a.preventDefault();var b=$(this).attr("data-modal-id");$("#"+b).addClass("revealed")}),$(".modal-wrapper").click(function(a){a.target==a.currentTarget&&$(this).removeClass("revealed")}),$(".modal-wrapper .dismiss").click(function(a){a.preventDefault(),$(this).closest(".modal-wrapper").removeClass("revealed")})}),$(function(){var a=$("#map-container");if(1==a.length){var b=a.attr("data-lat"),c=a.attr("data-lng"),d=L.mapbox.map(a[0],"flipside.hgeapagi",{zoomControl:!1,minZoom:2}).setView([b,c],12),e=a.attr("data-impact-area"),f=L.divIcon({className:"marker impact-area "+e,iconSize:[]});L.marker([b,c],{icon:f}).addTo(d)}}),$(document).foundation(),$("a.disabled, bttn.disabled").click(function(a){a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation()});